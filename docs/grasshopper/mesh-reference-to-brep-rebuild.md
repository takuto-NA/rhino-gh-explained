---
order: 25
---

# 参照メッシュからNURBS/Brepへ再構築（Grasshopperの“壊れにくい型”）

ここで扱うのは「Blender等から来たメッシュを **参照** しながら、Grasshopperで **パラメトリックに組み直して**、最終的に **NURBS/Brep** にする」ワークフローです。

ポイントは、メッシュをそのままNURBS化するのではなく、いったん **基準・ランドマーク・断面曲線**に落としてから面を作ることです。

> Blender→Rhinoの受け渡し（参照メッシュの作り方）: `../rhino/blender-mesh-to-rhino.md`  
> 「トポロジ依存が壊れる」注意: `history-and-editing.md` / `parameter-design.md`

## 全体像（基本原則）

```mermaid
flowchart LR
  RefMesh[RefMesh_Locked] --> Inputs[Inputs_Planes_Points_Curves]
  Inputs --> Curves[Curves_Contours_Pull_Fit]
  Curves --> Surfaces[Surfaces_Loft_Sweep_Network]
  Surfaces --> Brep[Brep_Join_Cap]
```

- **RefMeshは固定**（置き換えるなら“同じ意味の参照”にする）
- **Inputsをトポロジ非依存**にする（番号参照を避ける）
- **曲線で設計し、面は結果**にする（面を直接いじらない）

## 0) 参照メッシュを安定した状態にする（重要）

Grasshopperが壊れる典型はこれです。

- 参照元メッシュの **面分割/頂点数が変わった**
- 参照を “面の0番目”“エッジの3番目” のように **番号で掴んでいた**

対策:

- Rhino側で参照メッシュを `Lock`（`../rhino/blender-mesh-to-rhino.md` の「参照として固定」）
- GH側は **基準平面・ランドマーク点・断面曲線** で入力を持つ（番号依存をしない）

## 1) Inputs（入力）を設計する：最小セット

### 基準（Planes）

- 正中面（対称にしたいなら必須）
- 高さ基準面（例: 目の高さ、口の高さ）
- 前後基準面（奥行きの位置決め）

### ランドマーク（Points）

“後で位置を調整したい点”を入力にします。

- 例: 鼻先、瞳中心、口角、顎先、耳付け根 など

作成方法:

- Rhino上に点を置いて、GHの `Point` パラメータで参照する  
  - 後から点を動かせる＝パラメータ化できる

### 断面（Curves / Section Planes）

形を決める主役です。

- 正中プロファイル（横顔の基準）
- 複数の横断面（Contour）
- 必要なら縦断面（頬・鼻翼など局所）

## 2) 参照メッシュから曲線を取る（トポロジ非依存で）

代表的な取り方です（コンポーネント名は環境で多少違っても、カテゴリで辿れます）。

### A) Contour（一定間隔の断面）

- `Contour`（CurveカテゴリのUtil系）
  - 入力: Mesh（参照メッシュ）, Plane, Distance

運用上の注意:

- 距離は「後で変える入力」にする（断面密度をパラメトリックに調整できる）
- 必要な場所は “一定間隔” ではなく、**任意の断面平面を入力**にする方が設計が安定します

### B) Mesh × Plane（任意平面で切る）

- MeshとPlaneの交線を出す系（Intersectカテゴリにあります）

用途:

- 目の高さ/口の高さなど「意味のある平面」で断面を取る

### C) Pull / Project（ガイド曲線をメッシュへ吸着）

- `Pull Curve` / `Project` の系

用途:

- “この線はここを通ってほしい”というデザイン意図を、参照メッシュに寄せたい時

## 3) 曲線を“設計に使える形”へ整える（ここが品質）

参照から取った曲線は、そのままだとノイズが多いことが多いです。

一般的な整え方:

- `Simplify`（データ構造を単純化）
- `Rebuild Curve`（制御点数を揃える）
- `Fit Curve`（誤差許容で滑らかに近似）
- `Smooth`（必要なら）

指針:

- “見た目”より **後段が壊れない**（曲線が暴れない/接線が破綻しない）を優先
- 断面曲線群は、可能なら **同じ制御点数/同じ向き**に揃える（Loftが安定する）

## 4) 曲線からサーフェスを作る（目的別の型）

### A) Loft（断面が並んでいるとき）

- `Loft`

向いている:

- 横断面が順序よく並ぶ形状（外装全体など）

### B) Sweep2（レールが明確なとき）

- `Sweep2`（2レールスイープ）

向いている:

- 輪郭レール＋断面、のように“流れ”が明確な形状

### C) NetworkSrf（交差する曲線網が作れるとき）

- `Network Surface`

向いている:

- 縦/横の曲線が交差する“面の骨格”を作れる場合

### D) Patch（最後の手段として）

- `Patch`

注意:

- 設計意図が“面の近似”になりやすいので、ランドマークや境界曲線で強く拘束する

## 5) Brep化（Join / Cap）

最後に「ソリッドとして成立」させます。

- `Join Brep`
- 必要なら `Cap Holes`（閉じられる穴だけを閉じる）

> ここで失敗する場合は、曲線の段階（隙間/向き/交差）に戻って修正する方が効率的です。

## 6) “後から変えられる”設計にする（GH運用の作法）

最低限これだけで壊れにくくなります。

- 定義の左側に Inputs を集める（基準平面/ランドマーク/断面/数値）
- “番号で拾う”参照を避ける（List ItemやTreeのインデックスに依存しない）
- ベイク地点を意図的に決める（どこまでGHで管理するか）

> 関連: `history-and-editing.md`

## 次にやること

- 参照メッシュの受け渡し（Blender→Rhino）を詰める: `../rhino/blender-mesh-to-rhino.md`
- 受け渡し形式の相性（STEP/IGES/STL/3MF）: `../rhino/subd-cad-interoperability-and-formats.md`

