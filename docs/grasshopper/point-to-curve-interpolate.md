---
order: 36
---

# Interpolate（補間）：点列を通過する曲線を作る

このページは、`point-to-curve.md` の詳細版です（補間の挙動と選定の要点に集中します）。

## 基本

**Q: Interpolateコンポーネントの基本的な動作は？**

A: Grasshopperの `Interpolate` 系は、基本的に **NURBS曲線**を作ります。

**Q: Interpolateの保証事項は？**

A: 指定した点列を**必ず通過する**（理論的には完全に一致）ことを保証します。

**Q: 数値計算の誤差は？**

A: 浮動小数点演算の誤差により、完全に一致しない場合があります。Rhinoの公差設定（`DocumentProperties` → Units → Absolute tolerance、デフォルトはドキュメント単位に依存）内で一致することが多いですが、補間点が極端に不規則な場合は誤差が大きくなる場合があります。

**Q: 注意点は？**

A: 点が多い、または点列にノイズが含まれる場合、局所的な曲率の増大や振動（不要なうねり）が生じやすいです。

## Catmull-Romスプラインとの関係

### Catmull-Romスプラインとの違い

「すべての点を通す曲線」としてCatmull-Romスプラインをイメージする場合がありますが、Grasshopperの `Interpolate` は異なるアプローチを採用しています。

**Catmull-Romスプラインの特徴**:
- 4点（\(P_{i-1}, P_i, P_{i+1}, P_{i+2}\)）を使って、\(P_i\) と \(P_{i+1}\) の間のセグメントを局所的に生成
- 通常は均等パラメータ化（uniform parameterization）を使用
- 端点の扱いが特殊（端点を通さない場合がある、または特別な処理が必要）

**Grasshopperの `Interpolate`（NURBS補間）の特徴**:
- 点列全体を一度に解いて、すべての点を通過する制御点とノット配置を決定
- デフォルトで弦長パラメータ化（chord length parameterization）を使用（点間距離を反映）。`Interpolate`コンポーネントのパラメータ化オプションで変更可能
- 端点を必ず通過する（開いた曲線の場合）
- 次数（degree）を変更可能。デフォルトは3（3次NURBS曲線）。次数を変更すると、滑らかさと制御のバランスが変わる

**なぜNURBS補間を使うのか**:
- RhinoのジオメトリエンジンがNURBSを標準として扱うため、他のNURBS操作（ブーリアン、フィレット、サーフェス生成など）との互換性が高い
- パラメータ化の選択肢（弦長/均等）により、点間距離の影響を制御できる
- 次数を変更することで、滑らかさと局所的な制御のバランスを調整できる

### Catmull-Romスプラインを使いたい場合

Grasshopperの標準コンポーネントには、Catmull-Romスプラインを直接生成する機能はありません。Catmull-Romスプラインが必要な場合は、次の方法があります。

**方法1: Pythonスクリプトで実装する**

GrasshopperのPythonコンポーネントを使用して、RhinoCommonの`Curve.CreateCatmullRomSpline`メソッドを呼び出します。

```python
import Rhino.Geometry as rg

# inputs:
#   pts: Point3d[] (点列)

if pts and len(pts) >= 2:
    # Catmull-Romスプラインを生成
    # 端点を通す場合は closed=False
    crv = rg.Curve.CreateCatmullRomSpline(pts, closed=False)
    if crv:
        # outputs:
        #   crv: Curve
        a = crv
    else:
        a = None
else:
    a = None
```

**方法2: Interpolateで近似する**

`Interpolate`コンポーネントで均等パラメータ化（uniform parameterization）を指定すると、Catmull-Romスプラインに近い挙動になります。ただし、完全に同じにはなりません。

- `Interpolate`コンポーネントのパラメータ化オプションを「Uniform」に設定
- 点列が均等間隔に近い場合、結果がCatmull-Romに近づく

**方法3: プラグインを探す**

GrasshopperのコミュニティプラグインにCatmull-Romスプラインを提供するものがある可能性があります（推測）。標準機能ではないため、プラグインのメンテナンス状況や互換性を確認する必要があります。確認方法: Grasshopperのプラグインマネージャーやコミュニティフォーラムで検索する。

**Catmull-Romが必要な場面**:
- アニメーション/ゲーム開発で、既存のパイプラインと互換性が必要
- 局所的な4点補間の挙動が設計要件に合致している
- 均等パラメータ化による予測可能な挙動が必要

## KnotStyle（ノット配置）

**Q: InterpolateコンポーネントのKnotStyleの種類の違いは？**

A: `Interpolate`コンポーネントの`KnotStyle`入力は、ノット（knot）の配置方法を指定します。以下の3種類があります：

**1. Uniform (0) - 均等パラメータ化**
- ノットが均等に配置されます（パラメータ空間で等間隔）
- 各補間点間の距離に関係なく、パラメータ値が均等に割り当てられます
- **特徴**:
  - 点間距離の影響を受けない
  - Catmull-Romスプラインに近い挙動になる（点列が均等間隔に近い場合）
  - 点が不規則に配置されている場合、曲線が「暴れる」ことがある
- **適用場面**: 点列が均等間隔に近い場合、または均等パラメータ化が必要な場合

**2. Chord (1) - 弦長パラメータ化（デフォルト）**
- ノットが隣接する補間点間の距離（弦長）に比例して配置されます
- 点間距離が長い部分ではノット間隔が広く、短い部分では狭くなります
- **特徴**:
  - 点間距離を反映するため、形状が自然になる
  - 点が密な箇所では曲線の変化が細かく、疎な箇所では緩やかになる
  - 不規則な点列に対して安定した結果が得られる
- **適用場面**: 点列が不規則に配置されている場合、または点間距離を反映したい場合（推奨）

**3. SqrtChord (2) - 弦長平方根パラメータ化**
- ノットが隣接する補間点間の距離の平方根に比例して配置されます
- Chordと同様に点間距離を考慮しますが、平方根を取ることでノット間隔の変化がより緩やかになります
- **特徴**:
  - Chordより滑らかな曲線が得られる場合がある
  - 点間距離の差が大きい場合でも、ノット間隔の変化が緩やか
  - ChordとUniformの中間的な挙動
- **適用場面**: Chordでは曲線が「暴れる」が、Uniformでは点間距離が反映されない場合の妥協案

**選定基準**:
- **点列が均等間隔に近い** → Uniform
- **点列が不規則** → Chord（推奨）
- **Chordで曲線が不安定だが、点間距離は反映したい** → SqrtChord

**実務上の注意**:
- デフォルトはChord（1）で、多くの場合で適切な結果が得られます
- 点列の品質（順序、重複、ノイズ）が悪い場合、KnotStyleを変更しても根本的な問題は解決しません
- 点列の前処理（重複除去、順序確保、間引き）を先に行うことが重要です

## 次に読む

- NURBS補間の内部（線形システム、ノットベクトル、制御点抽出）: [`point-to-curve-nurbs-interpolation-notes.md`](./point-to-curve-nurbs-interpolation-notes)

