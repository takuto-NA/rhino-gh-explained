# Interpolate（補間曲線）の要点

このドキュメントは、点列を「必ず通る」曲線を生成する際の挙動と、最適な手法の選定基準について解説します。

Q: このページの目的は？

A: このページは、`point-to-curve.md` の詳細版として、補間曲線のアルゴリズム的な挙動、Catmull-Romスプラインとの違い、およびパラメータ化（KnotStyle）の選定基準に集中して解説します。

## 基本特性と制限

Q: Interpolateコンポーネントの基本的な動作と、使用上の注意点は何ですか？

A: `Interpolate` 系コンポーネントは **NURBS曲線**を生成し、入力された点列を**必ず通過する**（理論的な一致）ことを保証します。
ただし、実用上は以下の挙動を理解しておく必要があります：

- **計算誤差の可能性**: 浮動小数点演算の特性上、補間点が極端に不規則（非常に近い点と遠い点が混在するなど）な場合、Rhinoの絶対公差（Absolute tolerance）内に収まらない微小な誤差が生じることがあります。
- **振動（うねり）の発生**: 点列の数が多い場合や、座標にわずかなノイズが含まれる場合、意図しない局所的な曲率の増大や、曲線全体が波打つ「振動」が発生しやすくなります。これを防ぐには、事前に点列を間引くか、次数（Degree）を下げるなどの検討が必要です。

## Catmull-Romスプラインとの比較

Q: Catmull-Romスプラインと、Grasshopperの `Interpolate`（NURBS補間）にはどのような違いがありますか？

A: 両者は「すべての点を通す」という目的は同じですが、計算アプローチと結果の性質が異なります。

**Catmull-Romスプラインの特徴**:
- **局所的な計算**: 4点（\(P_{i-1}, P_i, P_{i+1}, P_{i+2}\)）の範囲でセグメントを決定するため、一部の点を動かしても影響が曲線全体に波及しません。
- **均等パラメータ化**: 通常は点間の距離を考慮しない均等間隔として扱われます。
- **制約**: Rhinoのネイティブジオメトリではないため、他のコマンド（ブーリアンやオフセット）との親和性がNURBSより低くなります。

**Grasshopperの `Interpolate`（NURBS補間）の特徴**:
- **全体的な計算**: 点列全体を一度に解いて制御点を決定するため、1点の移動が曲線全体に影響を与えますが、その分全体として滑らかな連続性が得られます。
- **弦長パラメータ化**: デフォルトで点間距離を反映するため、不規則な点列でも自然な形状になります。
- **次数（Degree）の変更**: デフォルトは3次ですが、用途に応じて変更可能です。

Q: なぜGrasshopper（Rhino）ではCatmull-RomではなくNURBS補間が多用されるのですか？

A: 主な理由は、Rhinoのジオメトリエンジンの標準がNURBSであるためです。NURBS補間を使うことで、生成した曲線をそのままサーフェスの輪郭として使ったり、高精度なオフセットやフィレット操作に繋げたりといった、後続のモデリング工程との互換性が最大化されます。

Q: 逆に、あえてCatmull-Romスプラインを選択すべきケースや、Grasshopperで実現する方法はありますか？

A: アニメーション制作やゲーム開発のパスとして既存のパイプラインと一致させる必要がある場合や、特定の局所的な補間挙動を求めている場合に選択されます。

Grasshopperで実現する方法は以下の通りです：
1. **Pythonスクリプト**: RhinoCommonの `Curve.CreateCatmullRomSpline` メソッドを呼び出します。
2. **Interpolateで近似**: `Interpolate` コンポーネントの KnotStyle を `Uniform` に設定すると、挙動がCatmull-Romに近づきます。

## KnotStyle（パラメータ化）の選定

Q: Interpolateコンポーネントの `KnotStyle` 入力は、曲線の形状にどのような影響を与えますか？

A: `KnotStyle` は、点列のパラメータ（ノット）をどのように割り当てるかを決定します。これにより、同じ点列でも「曲線の張り具合」が変わります。

- **Uniform (0)**: 点間距離を無視して均等に割り当てます。点が均等に配置されている場合に適しますが、不規則な点列では曲線が大きく乱れる原因になります。
- **Chord (1) [デフォルト]**: 点間距離（弦長）に比例して割り当てます。点が密な場所は細かく、疎な場所は緩やかに変化するため、最も自然で安定した結果が得られます。
- **SqrtChord (2)**: 距離の平方根に比例させます。UniformとChordの中間的な挙動で、Chordで曲がりが急すぎると感じた場合の妥協案として有効です。

**実務での使い分け基準**:
- 基本的には **Chord (1)** を使用してください。
- 点列が完璧に等間隔であることが分かっている場合のみ **Uniform (0)** を検討します。
- 曲線が「暴れる」場合は、KnotStyleを変えるよりも、まず点列の重複除去や平滑化などの前処理を行う方が効果的です。

## 次に読む

- NURBS補間の内部（線形システム、ノットベクトル、制御点抽出）: [`point-to-curve-nurbs-interpolation-notes.md`](./point-to-curve-nurbs-interpolation-notes)
