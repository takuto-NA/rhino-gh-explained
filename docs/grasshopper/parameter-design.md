---
order: 20
---

# パラメータ設計（壊れにくい入力の作り方）

## 基本方針

Q: Grasshopperで定義を作成する際、後からの変更に強い「パラメータ設計」を行う上で最も重要な考え方は何ですか？

A: Grasshopperで「一度作って終わり」ではなく、何度も試行錯誤や修正ができる状態を作るには、**「何を固定し、何を可変なパラメータ（入力）として持つか」を最初に明確に設計する**ことが重要です。入力が整理されていると、形状の大きな変更や、製造条件の微調整に即座に対応できるようになります。

## 目的別の推奨入力

Q: モデルの形状（造形）を柔軟に変更したい場合、どのような要素を入力パラメータとして持たせるのが効果的ですか？

A: 制御点を直接動かすよりも、以下の「幾何学的な意味を持つ要素」をパラメータにする方が、形状が破綻しにくく管理も容易です。

- **ランドマーク点**: 目頭/目尻、瞳中心、鼻先、口角、顎先など。これらを動かすことで全体のプロポーションを調整します。
- **基準平面/軸**: 正中面（対称軸）、目の高さ面、前後基準面など。
- **断面曲線（プロファイル）**: 目の高さの水平断面、口のライン、正中のシルエット曲線など。これらの曲線の位置や曲率を制御することで、立体的な造形をコントロールします。

Q: 製造（3Dプリント等）に関する設定を調整可能にするために、どのような数値をパラメータとして管理すべきですか？

A: 3Dプリンタの個体差や材料の特性に合わせて微調整できるよう、以下の数値を「外部入力」として出しておきます。

- **シェルの厚み**: 例：`1.0mm`（製造強度や重量の調整用）。
- **クリアランス（隙間）**: 例：`0.2mm〜0.6mm`（部品同士の嵌まり具合の調整用）。
- **補強構造の寸法**: リブの厚み、フランジの幅、ネジボスの直径など。

## 避けたい入力

Q: Grasshopperの定義を壊れにくくするために、入力として避けるべき、あるいは注意が必要なデータ参照の方法はありますか？

A: **「トポロジ依存の参照（インデックス指定）」**は、形状の少しの変化で定義が全滅する最大の原因になるため、可能な限り避けます。

- **避けるべき例**: 「面の0番目を取得する」「エッジの3番目を選択する」といった操作。
- **理由**: 入力するメッシュやサーフェスの分割数が変わると、これらインデックス番号はすぐにズレてしまい、意図しない場所を処理してしまいます。
- **対策**: 番号で選ぶのではなく、「最もZ値が大きい面」「特定の点に近いエッジ」といった、幾何学的な条件でフィルタリングして選択するように組みます。

## パラメータの管理

Q: 複雑になったGrasshopper定義の中で、多くのパラメータを混乱させずに管理するためのベストプラクティスはありますか？

A: 定義を「左から右へ流れる」構造に保ち、入り口を整理することが鉄則です。

- **インプットの集約**: 定義の最も左側に **"Inputs"** グループを作り、すべてのスライダーや参照コンポーネントをそこに配置します。
- **命名の徹底**: スライダーには必ず `Thickness_mm` や `EyeWidth_mm` のように名前を付け、単位も明記します。
- **コンテナの活用**: 曲線や点などの参照データも、単体で置かずに適切な名前を付けたコンテナコンポーネントに格納します。

## 単位・公差の扱い

Q: Grasshopper内で数値を扱う際、Rhino本体のドキュメント単位や公差（Tolerance）の設定はどのように影響しますか？

A: Grasshopperの計算は、常に**Rhinoドキュメントの設定**を基準に行われます。

- **単位の同期**: Rhinoが `mm` 設定なら、GHのスライダーの `1.0` は `1.0mm` として扱われます。
- **公差の壁**: 1.0mm程度の薄肉シェルや0.2mmの隙間を設計する場合、Rhinoの許容差（Tolerance）が大きすぎると、ブーリアン演算やオフセットが失敗しやすくなります。設計対象の最小寸法に対して十分小さな公差（例：0.01mm以下）に設定されているか確認してください。

> 関連: `../rhino/units-tolerance-and-mesh-health.md`（公差と単位の詳細）

## チェックリスト

Q: パラメータ設計の最終確認項目は？

A: 以下の3点を確認し、後からの変更に強い定義になっているか検証します。

- [ ] **入力の網羅性**: 変更したい要素が「入力（スライダー/曲線/点）」として漏れなく存在するか。
- [ ] **トポロジ非依存**: 番号指定（面0/エッジ3など）ではなく、基準点や断面曲線による制御が徹底されているか。
- [ ] **製造の余裕**: 厚みやクリアランスを、テストピースの結果に合わせて後から微調整できる構成になっているか。
