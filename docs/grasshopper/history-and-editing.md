---
order: 10
---

# Grasshopperの「履歴」と後編集（壊れにくい作り方）

Rhinoには「History（履歴）」機能がありますが、Grasshopperの強みはそれとは別で、**データフロー（入力→計算→出力）を定義して、入力を変えるだけで再計算できる**ことです。

この章では、Grasshopperで「後から変えられる」状態を作るための考え方をまとめます。

## Grasshopperの“履歴”の正体

- **定義（.gh/.ghx）**が設計のルール（手順）\n- **入力パラメータ**が設計変数\n- **出力ジオメトリ**は計算結果\n
つまり「履歴を残す」= **後から変えたいところを入力にする**ことです。

## 参照（Reference）とベイク（Bake）

### Reference（参照）

- GHからRhino上のオブジェクトを参照して計算する\n- Rhino側のオブジェクトを置き換えると、GHも追従する\n
注意: 参照元のトポロジが変わる（例: 面分割が変わる、エッジ数が変わる）と、後段のコンポーネントが壊れることがあります。

### Bake（ベイク）

- GHの結果をRhinoに“固定”して出す\n- ベイクした瞬間にGHとのリンクは切れる（=履歴はそこまで）\n
実務のコツ: 「造形はGHで」「仕上げはRhinoで」になる場合は、ベイク地点を意図的に作ると運用が安定します。

## パラメータ設計の基本（後編集に強くする）

壊れにくい順に並べるとこうなります。

- **数値（スライダー）**: 厚み、幅、高さ、オフセット量、角度
- **基準（平面/軸/点）**: 正中面、目の高さ、基準点（ランドマーク）
- **曲線（断面/ガイド）**: 断面を動かして形状を作る
- **（避けたい）トポロジ依存**: “面の○番目”“エッジの○番目”のような参照

### オフセットをGHでやる場合の指針（要点だけ）

- **厚みを後から頻繁に振る** → GHで `Offset Surface` / `Offset Mesh` を使う価値が高い
- **最終確定だけ** → Rhino側で `OffsetSrf` / `Shell` の方が安定しやすい

> 詳細（対象別のコンポーネント名）: `parametric-shell-example.md`

「汚いメッシュ→再構築」系のワークフローは特に、トポロジ依存が壊れやすいので、**基準と断面曲線**を入力に寄せるのが安全です。

## 後から編集しやすいGH定義の作法

- **入力を一箇所に集める**（スライダー群、基準平面、ランドマーク）\n- **段階（レイヤー）を分ける**: 造形 → 厚み → 分割/穴 → 補強\n- **中間結果を可視化**（プレビューON/OFF、ラベル、グループ化）\n- **失敗しやすい所は“手前で検出”**（厚み前に曲率が強すぎないか等）\n
## RhinoのHistoryとの関係

- RhinoのHistoryは「この操作はこの入力から作られた」という紐づけ\n- GHは「入力が変われば結果が変わる」という再計算\n
両方を同時に完璧に保つのは難しいので、\n+**GHを主履歴**として設計し、RhinoのHistoryは補助程度に使うのが無難です。

## チェックリスト（後編集できるか）

- [ ] 変更したい値がスライダー/入力に集約されている
- [ ] 参照が“番号依存”になっていない（面0/エッジ3など）
- [ ] ベイク地点が意図的に決まっている（どこまでGHで管理するか）
- [ ] 破綻した時に直しやすい（段階が分離されている）

## 鏡像（左右対称）デザインの作り方（Grasshopper）

結論としては **「片側だけ設計して、対称平面でミラーする」**のが一番壊れにくいです。

### 1) 対称平面を入力として持つ

- まず **対称平面**（多くはYZ）を決め、GHに入力します
  - Rhino側で平面を用意して参照する、またはGH内で `YZ Plane` のような基準平面を使う

### 2) 片側だけ作る（右/左どちらかに統一）

- ランドマーク点、断面曲線、外形サーフェスなど、“形を決める要素”は片側だけ作る/参照する
- これで編集点が半分になり、後からの修正が圧倒的に楽になります

### 3) Mirrorコンポーネントで反対側を生成する

代表的なコンポーネント（標準GH）:

- **ジオメトリ**: `Mirror`（Transform）
  - 入力: Geometry, Plane
- **点**: `Mirror Point`（Point）
  - 入力: Point, Plane

### 4) 継ぎ目（正中）の扱い

左右を単純に重ねると、正中で二重になったり、面が被ったりします。運用としては次のどちらかが安全です。

- **正中でピッタリ合わせて結合**（面/ソリッドにしたい時）
- **少しオーバーラップさせて後段でトリム/ブーリアン**（安定性優先）

### 5) “左右非対称”を後から入れたい場合

基本は「対称を維持する定義」と「非対称の差分」を分けます。

- まず対称モデルを作る（Mirrorまで）
- 最後段に “差分” を足す（右だけ+2mm、左だけ角度変更など）

## チェックリスト（対称が保てているか）

- [ ] 対称平面が1つの入力として存在する
- [ ] 形状を決める要素（点/曲線/断面）は片側だけで管理している
- [ ] Mirror後の正中で二重/被りがない（意図的にオーバーラップさせる場合を除く）

