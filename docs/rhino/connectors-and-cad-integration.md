---
order: 60
---

# コネクタ追加・機構CADとの統合（壊しにくい合わせ方）

この章は、外装（有機形状）に対して **機構CAD**（ソリッド/精密寸法）や **コネクタ**（ねじ/嵌合/差し込み）を後から足す時に、モデルを壊しにくくするための考え方をまとめます。

## 大原則：有機面に“直接”機構を貼らない

有機形状にそのままボスや穴を押し当てると、以下が起きやすいです。

- Booleanが失敗する
- 面がヨレて強度が落ちる
- 組付け時に当たりが不安定（ガタ/浮き）

なので、まず **当たり面（インターフェース）** を作ります。

## 当たり面（インターフェース）を作る

コネクタや機構が載る部分に、以下のどれかを作ってから統合します。

- **平面パッド**: ねじ/磁石/嵌合の土台
- **円筒座**: 軸、穴、ボスの基準
- **フランジ**: 分割の合わせ面と一体で作ると強い

当たり面は、「有機外装 → 当たり面 → 機構」の順に階層化すると、変更が入っても壊れにくいです。

## コネクタの基本パターン（外装側）

- **ねじ止め**
  - ボス（柱）＋座面（平面）＋リブ（割れ止め）
- **嵌合**
  - キー（方向決め）＋段差（位置決め）＋逃げ（クリアランス）
- **差し込み**
  - テーパ（入れやすさ）＋止まり面（位置）

FDMは積層方向で強度が変わるので、ねじ/嵌合の“割れる方向”を想定して、リブや肉厚で補います。

## Rhinoコマンド：当たり面→ボス/嵌合→最後に穴（手順テンプレ）

### 1) 当たり面（平面パッド）を作る

1. 当たりにしたい領域を決める（できるだけ平ら/緩い曲率の場所）
2. パッド形状を作る: `Rectangle` / `Circle` / `Polyline`
3. 必要なら押し出す: `ExtrudeCrv`（厚みを付ける）
4. 外装側と一体化: `BooleanUnion`（Brep同士で安定）

> スクショ位置案: 平面パッドの位置決め（外装に対してどう“座”を作るか）

### 2) ボス（ねじ）を作る

- ボス本体: `Cylinder`（または `Circle` → `ExtrudeCrv`）
- リブ: `Polyline` → `ExtrudeCrv` → `BooleanUnion`
- 穴あけ（最後に）: `BooleanDifference`

### 3) 嵌合（キー/段差）を作る

- キー（方向決め）: `Box` / `ExtrudeCrv`
- 段差（位置決め）: `Offset` / `MoveFace`（Brepの場合）
- 逃げ（クリアランス）: “相手形状を少しオフセットしてから差分”が安全

## RhinoCommon（C#）: ボス用カッターをオフセットして差分する発想

ここでは「相手形状を少し大きくして（クリアランスを作って）から差分する」考え方だけ示します。

```csharp
using Rhino;
using Rhino.Geometry;

// cutterBrep を clearance 分だけオフセットしてから BooleanDifference する、という発想
// ※ 実運用では null チェックや結果の配列処理が必要
public static Brep CutWithClearance(Brep shell, Brep cutterBrep, double clearance)
{
  double tol = RhinoDoc.ActiveDoc?.ModelAbsoluteTolerance ?? 0.01;

  Brep[] blends;
  Brep[] walls;
  var offsetCutters = Brep.CreateOffsetBrep(cutterBrep, clearance, true, false, tol, out blends, out walls);
  if (offsetCutters == null || offsetCutters.Length == 0) return null;

  var result = Brep.CreateBooleanDifference(shell, offsetCutters[0], tol);
  return (result != null && result.Length > 0) ? result[0] : null;
}
```

## チェックリスト（機構統合）

- [ ] 有機外装は先に“閉じた殻”として成立している（穴/非多様体/自交差が無い）
- [ ] 機構は直接貼らず、当たり面（平面/円筒/フランジ）を作ってから統合する
- [ ] 穴あけは最後（途中で開けすぎると変更に弱い）
- [ ] ねじ/嵌合は“割れる方向”を想定してリブ/肉厚を入れる

## テストピース（コネクタ周り）

- **ボス割れテスト**: リブ有無/ボス径/座面厚を変えたサンプル
- **嵌合クリアランスラダー**: 0.1〜0.6mm（プリンタ/材料/設定で最適値が変わる）

## 有機外装（Mesh/SubD）と機構（ソリッド）を合流する手順

安全な順序は以下です。

1. 外装を“閉じた殻”として成立させる（穴/非多様体/自交差が無い）
2. 当たり面（平面/円筒/フランジ）を外装側に作る
3. 機構CADの取り付け基準（穴中心・座面）を合わせる
4. 最後に穴・切り欠き・ボス等を入れて、出力検証

「外装と機構を早い段階でBooleanして一体化」は、変更に弱いので避けるのが無難です。

## 次にやること

次章では、STL/3MF出力と、スライサーでの最終検証（壁数・薄肉・サポート）を整理します。

