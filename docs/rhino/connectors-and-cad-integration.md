---
order: 60
---

# コネクタ追加・機構CADとの統合（壊しにくい合わせ方）

Q: 外装（有機形状）に対して機構CADやコネクタを後から統合する際、モデルを壊さないための基本的な考え方は？

A: **「当たり面（インターフェース）」を独立させて設計し、有機面に直接機構を配置しない** ことが鉄則です。

- **直接配置の問題点**: 有機的な曲面に直接ボスや穴を作ろうとすると、ブーリアン演算の失敗や、接合部の強度が著しく低下するリスクが高まります。
- **解決策**: 「外装」と「機構部品」の間に、**平面パッド（平らな座）や円筒座** といった単純な幾何形状の中間層を介在させます。この中間層を基準に設計することで、機構側の変更が外装に、また外装の変更が機構に直接悪影響を及ぼすのを防ぎ、変更に強いデータ構造を維持できます。

## コネクタの設計パターンとRhinoでの作成手順

Q: 外装側に設ける固定機構（ねじ止めや嵌合）の種類と、それらをRhinoで作成する具体的な手順は？

A: 3Dプリント（FDM等）の特性を考慮し、**「安定した面を先に作り、補強を添える」** 流れで作成します。

1. **平面パッド（部品の載置面）**: 
   - `Rectangle` 等で輪郭を描き、`ExtrudeCrv` で外装の内側に突き刺さるような厚みを持たせます。その後、`BooleanUnion` で外装と一体化させます。
2. **ねじ止めボス**:
   - `Cylinder` で柱を作り、その根元に `ExtrudeCrv` で作成した「リブ（三角形の補強板）」を添えます。これにより、ねじ締め時の根元からの破断を防ぎます。
3. **嵌合（キーと段差）**:
   - `Box` や `ExtrudeCrv` で凸形状（キー）を作ります。
   - 相手側の凹形状を作る際は、元形状を `Offset` 等でわずかに拡大（0.1〜0.3mm程度）したものをカッターとして `BooleanDifference` することで、適切な「逃げ（クリアランス）」を確保できます。

## スクリプトによるクリアランス処理の自動化

Q: プログラム（C#等）を用いて、クリアランスを確保したブーリアン処理を自動化するメリットと実装例は？

A: 相手形状を正確に一定距離オフセットしてから切り抜く処理をコード化することで、手動での操作ミス（オフセットのし忘れ等）を防ぎ、常に一定の嵌合品質を保てます。

```csharp
// クリアランスを考慮した切り欠き処理（概念例）
public static Brep CutWithClearance(Brep shell, Brep cutter, double clearance)
{
    double tol = 0.01;
    // カッターをクリアランス分だけ太らせる
    Brep[] offsetCutters = Brep.CreateOffsetBrep(cutter, clearance, true, false, tol, out _, out _);
    if (offsetCutters == null || offsetCutters.Length == 0) return null;

    // 太らせたカッターで外装（shell）を切り抜く
    return Brep.CreateBooleanDifference(shell, offsetCutters[0], tol)?[0];
}
```

## ワークフローの理想的な順序とチェックリスト

Q: 有機外装と機構部品を最終的に合流させる、最も安全な順序は？

A: 各要素が独立して調整できる状態を可能な限り長く保つため、以下の順序を推奨します。

1. **外装の健全化**: 穴や自己交差のない「閉じたソリッド（殻）」を完成させる。
2. **当たり面の設置**: 外装側に平面や円筒の受け口（インターフェース）を作る。
3. **機構の配置**: インターフェースを基準に、機構CADの取り付け位置を合わせる。
4. **最終統合（穴あけ）**: 最後にネジ穴やボスの一体化を行い、出力検証を行う。

**最終確認項目**:
- **ソリッド性**: 最終結果が「閉じたBrep（Closed Brep）」になっているか。
- **当たり面の有無**: 機構部品が有機面に「めり込んでいるだけ」ではなく、平面パッド等を介しているか。
- **プリント強度**: ねじ締め部や嵌合部に、割れを防止するための十分な肉厚やリブがあるか。
