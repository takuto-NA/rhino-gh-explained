---
order: 20
---

# 単位・公差・メッシュ健全性（製造に入る前のチェック）

Q: モデリングの中盤や後半で発生する「ブーリアン演算の失敗」や「エクスポートエラー」を未然に防ぐために、最初に行うべき準備は何ですか？

A: 後の工程（厚み付け、分割、穴あけ、ソリッド演算など）を安定させるための「最初の地ならし」として、**「適切な単位と公差の設定」**、および**「入力メッシュの健全性チェック」**を徹底します。特に有機的な形状は、見た目では気づかない微小な隙間や法線の乱れが、致命的なエラーを引き起こす原因になります。

## 単位（Units）の管理

Q: Rhinoで作成したモデルのサイズを、実際の製造寸法（mm単位など）と一致させるために理解しておくべき「単位（Units）」の仕組みを教えてください。

A: Rhinoは **「ドキュメント単位」** に基づいてすべての数値を解釈します。

- **一貫性の維持**: モデルがmm単位で設計されるべきなら、ドキュメント設定も必ずmmにする必要があります。
- **後からの変更リスク**: モデリングの途中で単位を変更すると、スケールの不一致や公差の再計算による予期せぬトラブルが発生しやすいため、プロジェクト開始時に固定するのが鉄則です。

Q: 現在のモデルの単位設定を確認したり、必要に応じて変更したりするための主要なコマンドは何ですか？

A: 以下のコマンドを使用します。
- `Units`: ドキュメント全体の単位系と精度を素早く確認・変更できます。
- `DocumentProperties`: 「単位」セクションから、単位系と許容差（Tolerances）を詳細に設定できます。

## 公差（Absolute tolerance）の重要性

Q: Rhinoの「絶対許容差（Absolute Tolerance）」の設定が、モデリングの成功率（JoinやBooleanの成否）にどのように影響しますか？

A: 製造向けの詳細設計で発生するエラーの多くは、この「公差」の設定ミスに起因します。

- **Joinの失敗**: 公差が大きすぎると、本来つながるべき面同士の間に「微小な隙間」が残っていると判断され、ソリッド化（結合）できません。
- **オフセット/シェルの破綻**: 薄肉（1mmなど）の設計をする際、公差が不適切だと、曲率が急な部位でサーフェスのオフセット計算が無限ループしたり、自己交差を引き起こしたりします。
- **方針**: 「細部を再現するために細かすぎず、かといってブーリアンが失敗するほど粗すぎない」値（一般的には 0.001mm〜0.01mm 程度）を、製造物のスケールに合わせて設定します。

Q: モデルがうまく結合できない、あるいは「壊れている」疑いがあるとき、原因を特定するために使用すべき診断コマンドはどれですか？

A: 以下の診断ツールを組み合わせて原因を切り分けます。
- `Check`: オブジェクトの内部データ構造をスキャンし、数学的なエラーがないか判定します。
- `SelBadObjects`: データとして破損している（Bad Object）を強制的に選択します。
- `ShowEdges`: 面と面のつながりを可視化します。特につながっていないエッジ（Naked Edges）を赤く表示させることで、結合の失敗箇所を一目で特定できます。

## メッシュの健全性（Mesh Health）

Q: スキャンデータや外部ソフトから持ち込んだ「既存のメッシュデータ」をRhinoで扱う際、事前に「健全性チェック」を行うべき理由は何ですか？

A: 持ち込まれたメッシュは、見た目が綺麗でも「製造（ソリッド演算）に適さない」場合が多いためです。問題の種類を早期に特定することで、「そのまま直すべきか、あるいは作り直すべきか」を判断できます。

Q: 3Dプリントや厚み付け処理を失敗させる原因となる、メッシュデータ特有の「代表的な不具合」にはどのようなものがありますか？

A: 以下の5つの不具合が、後工程を破綻させる主要因です。
- **穴（Open edges）**: どこかが開いていて、完全に閉じたソリッドになっていない。
- **法線の乱れ（Inconsistent normals）**: 面の表裏がバラバラで、厚み付けの方向が計算できない。
- **非多様体（Non-manifold）**: 1つのエッジから3枚以上の面が出ているなど、物理的にあり得ない接続。
- **自己交差（Self-intersection）**: メッシュ同士が突き抜けて重なっている（厚み付けでほぼ確実に失敗します）。
- **過密な頂点**: 細かすぎるディテールが計算負荷を高め、コマンドをフリーズさせる。

Q: メッシュの不具合箇所を見つけ出し、必要に応じてRhino上で修復を試みるための便利なコマンドを教えてください。

A: 
- **診断**: `CheckMesh`（問題点をレポート）、`Dir`（法線の向きを矢印で確認）。
- **修復**: `UnifyMeshNormals`（表裏を自動で揃える）、`FillMeshHoles`（開いている穴を塞ぐ）、`RepairMesh`（総合的な自動修復ダイアログ）。

Q: 入手したメッシュデータを「使えるデータ」にするために、まず最初に行うべき最低限のチェック手順は？

A: 以下の3ステップを「型」として実施してください。
1. **断面の目視確認**: クリップ面（`ClippingPlane`）を使い、顔などの内側に「不要な板」や「裏返った面」が隠れていないか確認します。
2. **穴の位置の特定**: `ShowEdges` でどこが開いているかを把握し、その穴が「本来開いているべき場所（首など）」かを確認します。
3. **法線の統一**: 厚み付けを行う前に、必ず法線がすべて「外側」を向いているかを確認します。

Q: Grasshopper（Pythonスクリプト）を使用して、大量のメッシュの「自己交差」や「法線の不一致」を自動で判定させることはできますか？

A: はい、`RhinoCommon` のAPIを介して、以下のような簡易チェッカーを構築できます。

```python
import rhinoscriptsyntax as rs

# input:
#   x: mesh id (Guid)

if x and rs.IsMesh(x):
    # 法線の一貫性チェック
    if not rs.MeshHasConsistentNormals(x):
        print("WARN: mesh normals are inconsistent")
    # 自己交差チェック
    if rs.IsMeshSelfIntersecting(x):
        print("WARN: mesh is self-intersecting")
else:
    print("input is not a mesh")
```

## 最終確認と判断基準

Q: すべてのモデリング工程を終え、いよいよ製造（スライス）に回す前に、最後にもう一度確認すべきチェックポイントは何ですか？

A: 以下の4点を確認し、製造への移行可否を判断します。
- [ ] **単位の一致**: `Units` が確実に `mm` 設定になっているか。
- [ ] **重大なエラーの皆無**: `SelBadObjects` で何も選択されない状態か。
- [ ] **断面の整合性**: モデルを切断した際、壁の中に意図しない隙間や余計な面が残っていないか。
- [ ] **ワークフローの妥当性**: メッシュの不具合があまりに多い場合、無理に直そうとせず `QuadRemesh → SubD` での再構築に切り替えたか。

Q: 複雑なメッシュデータの修復に苦戦している場合、作業を打ち切って「最初から作り直す（リトポロジ）」べき判断基準はどこにありますか？

A: 顔のような「有機的な曲面」で自己交差や非多様体エッジが数千箇所もあるような場合、手作業での修復は不可能です。その場合は、原型メッシュを単なる「参照」として使い、**次章で解説する `QuadRemesh` を用いたSubD化**へ速やかに移行するのが、最も確実で時間の無駄がありません。
